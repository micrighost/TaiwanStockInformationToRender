<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>資料庫檢查</title>
    <!-- 引入 jQuery 函式庫，用於簡化 DOM 操作和 AJAX 請求 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>資料庫檢查</h1>
    <!-- 按鈕，點擊後觸發資料庫檢查 -->
    <button id="checkButton">檢查資料庫</button>
    <!-- 顯示訊息的容器 -->
    <div id="output"></div>

    <script>
        $(document).ready(function() {
            // 當 DOM 載入完成後執行，確保所有元素都已載入
            $('#checkButton').click(function() {
                // 當按鈕被點擊時執行

                // 禁用按鈕，避免重複點擊
                // 使用 prop() 方法來設定 disabled 屬性為 true
                $('#checkButton').prop('disabled', true);

                // 馬上顯示提示訊息
                // 使用 html() 方法來更新 #output 容器的內容
                $('#output').html('<p>正在幫你檢查資料庫，這會花很久，請稍後。</p>');

                // 發送 POST 請求到後端
                // 使用 $.post() 方法發送異步 POST 請求到 /check_database 路由
                $.post('/check_database', function(data) {
                    // 後端回傳後，顯示所有訊息
                    // 使用 map() 方法將 data.messages 陣列轉換為 HTML 字串
                    // 使用 join() 方法將 HTML 字串連接起來，然後更新 #output 容器
                    $('#output').html(data.messages.map(msg => '<p>' + msg + '</p>').join(''));
                })
                .always(function() {
                    // 請求完成後，恢復按鈕可用
                    // 無論請求成功或失敗，都會執行此區塊
                    // 使用 prop() 方法來設定 disabled 屬性為 false，恢復按鈕可用
                    $('#checkButton').prop('disabled', false);
                });
            });
        });
    </script>
</body>
</html>