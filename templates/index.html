<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>資料庫管理</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>資料庫管理</h1>

    <!-- 檢查資料庫按鈕 -->
    <button id="checkButton">檢查資料庫</button>

    <!-- 更新資料庫按鈕 -->
    <button id="updateButton">更新資料庫</button>

    <!-- 刪除資料庫按鈕（可選） -->
    <button id="deleteButton">刪除資料庫</button>

    <div id="output"></div>

    <script>
        $(document).ready(function() {
            // 檢查資料庫按鈕事件
            $('#checkButton').click(function() {
                // 點擊 "檢查資料庫" 按鈕時執行
                disableButtons(true); // 禁用所有按鈕，防止重複操作
                $('#output').html('<p>正在檢查資料庫，請稍後...</p>'); // 顯示提示訊息

                $.post('/check_database', function(data) {
                    // 發送 POST 請求到 '/check_database'，並處理回傳資料
                    $('#output').html(data.messages.map(msg => '<p>' + msg + '</p>').join('')); // 將回傳訊息顯示在頁面上
                }).always(function() {
                    // 無論請求成功或失敗，都執行此函式
                    disableButtons(false); // 恢復按鈕可用
                });
            });

            // 更新資料庫按鈕事件
            $('#updateButton').click(function() {
                // 點擊 "更新資料庫" 按鈕時執行

                // 顯示確認視窗，詢問使用者是否確定更新
                if (!confirm("確定要更新資料庫嗎？")) {
                    return; // 如果使用者取消，則不執行後續操作
                }

                disableButtons(true); // 禁用所有按鈕，防止重複操作
                $('#output').html('<p>開始重構資料庫，這會花很久，請稍後...</p>'); // 顯示提示訊息

                $.post('/update_database', function(data) {
                    // 發送 POST 請求到 '/update_database'，並處理回傳資料
                    $('#output').html(data.messages.map(msg => '<p>' + msg + '</p>').join('')); // 將回傳訊息顯示在頁面上
                }).always(function() {
                    // 無論請求成功或失敗，都執行此函式
                    disableButtons(false); // 恢復按鈕可用
                });
            });

            // 刪除資料庫按鈕事件
            $('#deleteButton').click(function() {
                // 點擊 "刪除資料庫" 按鈕時執行

                // 顯示確認視窗，詢問使用者是否確定刪除
                if (!confirm("確定要刪除資料庫嗎？此動作無法復原！")) {
                    return; // 如果使用者取消，則不執行後續操作
                }

                disableButtons(true); // 禁用所有按鈕，防止重複操作
                $('#output').html('<p>正在刪除資料庫，請稍後...</p>'); // 顯示提示訊息

                $.post('/delete_database', function(data) {
                    // 發送 POST 請求到 '/delete_database'，並處理回傳資料
                    $('#output').html(data.messages.map(msg => '<p>' + msg + '</p>').join('')); // 將回傳訊息顯示在頁面上
                }).always(function() {
                    // 無論請求成功或失敗，都執行此函式
                    disableButtons(false); // 恢復按鈕可用
                });
            });

            // 按鈕啟用/禁用函式
            function disableButtons(disable) {
                // 根據传入的 disable 參數，禁用或啟用所有按鈕
                $('#checkButton').prop('disabled', disable); // 禁用或啟用 "檢查資料庫" 按鈕
                $('#updateButton').prop('disabled', disable); // 禁用或啟用 "更新資料庫" 按鈕
                $('#deleteButton').prop('disabled', disable); // 禁用或啟用 "刪除資料庫" 按鈕
            }
        });
    </script>
</body>
</html>